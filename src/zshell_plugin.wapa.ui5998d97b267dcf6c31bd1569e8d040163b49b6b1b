sap.ui.define([                                                                                                                                                                                                                                                
    "sap/ui/core/UIComponent",                                                                                                                                                                                                                                 
    "com/qdt/zshellplugin/model/models",                                                                                                                                                                                                                       
    "sap/m/MessageToast"                                                                                                                                                                                                                                       
], (UIComponent, models, MessageToast) => {                                                                                                                                                                                                                    
    "use strict";                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    return UIComponent.extend("com.qdt.zshellplugin.Component", {                                                                                                                                                                                              
        metadata: {                                                                                                                                                                                                                                            
            manifest: "json",                                                                                                                                                                                                                                  
            interfaces: [                                                                                                                                                                                                                                      
                "sap.ui.core.IAsyncContentCreation"                                                                                                                                                                                                            
            ],                                                                                                                                                                                                                                                 
            "sap.ushell": {                                                                                                                                                                                                                                    
        "type": "plugin",                                                                                                                                                                                                                                      
        "fullWidth": true                                                                                                                                                                                                                                      
      }                                                                                                                                                                                                                                                        
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        init() {                                                                                                                                                                                                                                               
            UIComponent.prototype.init.apply(this, arguments);                                                                                                                                                                                                 
            this._createLaunchpadButton();                                                                                                                                                                                                                     
            this.setModel(models.createServiceModel(), "service");                                                                                                                                                                                             
            this.setModel(models.createDeviceModel(), "device");                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        _getRenderer: function () {                                                                                                                                                                                                                            
            var oDeferred = new jQuery.Deferred();                                                                                                                                                                                                             
            this._oShellContainer = jQuery.sap.getObject("sap.ushell.Container");                                                                                                                                                                              
            if (!this._oShellContainer) {                                                                                                                                                                                                                      
                oDeferred.reject("Illegal state: shell container not available");                                                                                                                                                                              
            } else {                                                                                                                                                                                                                                           
                var oRenderer = this._oShellContainer.getRenderer();                                                                                                                                                                                           
                if (oRenderer) {                                                                                                                                                                                                                               
                    oDeferred.resolve(oRenderer);                                                                                                                                                                                                              
                } else {                                                                                                                                                                                                                                       
                    this._onRendererCreated = function (oEvent) {                                                                                                                                                                                              
                        oRenderer = oEvent.getParameter("renderer");                                                                                                                                                                                           
                        if (oRenderer) {                                                                                                                                                                                                                       
                            oDeferred.resolve(oRenderer);                                                                                                                                                                                                      
                        } else {                                                                                                                                                                                                                               
                            oDeferred.reject("Illegal state: shell container not available");                                                                                                                                                                  
                        }                                                                                                                                                                                                                                      
                    };                                                                                                                                                                                                                                         
                    this._oShellContainer.attachRendererCreatedEvent(this._onRendererCreated);                                                                                                                                                                 
                }                                                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
            return oDeferred.promise();                                                                                                                                                                                                                        
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        _createLaunchpadButton: function () {                                                                                                                                                                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            var that = this;                                                                                                                                                                                                                                   
            this._getRenderer().fail(function (sErrorMessage) {                                                                                                                                                                                                
                jQuery.sap.log.error(sErroMessage, undefined, "com.qdt.zshellplugin.Component");                                                                                                                                                               
            }).done(function (oRenderer) {                                                                                                                                                                                                                     
                oRenderer.addHeaderEndItem("sap.ushell.ui.shell.ShellHeadItem", {                                                                                                                                                                              
                    id: "com.qdt.zshellplugin",                                                                                                                                                                                                                
                    icon: "sap-icon://ai",                                                                                                                                                                                                                     
                    tooltip: "Ask ABHI",                                                                                                                                                                                                                       
                    press: this._showHelpMenu.bind(this),                                                                                                                                                                                                      
                }, true, false);                                                                                                                                                                                                                               
            }.bind(this));                                                                                                                                                                                                                                     
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        _showHelpMenu: function (oEvent) {                                                                                                                                                                                                                     
            var oButton = oEvent.getSource();                                                                                                                                                                                                                  
            if (!this._cMenu) {                                                                                                                                                                                                                                
                this._cMenu = sap.ui.xmlfragment("com.qdt.zshellplugin.fragments.Dialog", this);                                                                                                                                                               
                //sap.ui.controller("com.qdt.zshellplugin.controller.View1").addDependent(this._cMenu);                                                                                                                                                        
                this._cMenu.setModel(this.getModel("service"), "service");                                                                                                                                                                                     
            }                                                                                                                                                                                                                                                  
            //this._cMenu.open(oButton);                                                                                                                                                                                                                       
            sap.ui.getCore().byId("oID_AI_ABHI_CHAT").removeAllItems();                                                                                                                                                                                        
            sap.ui.getCore().byId("oID_QueryInput").setValue('');                                                                                                                                                                                              
            sap.ui.controller("com.qdt.zshellplugin.controller.View1").oLoadInitialData(this._cMenu, oButton);                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onServiceSelected: function (oEvent) {                                                                                                                                                                                                                 
            var oBindingContext = oEvent.getSource().getBindingContext("service");                                                                                                                                                                             
            var sSelectedServiceUrl = oBindingContext.getProperty("url");                                                                                                                                                                                      
            window.open(sSelectedServiceUrl, '_blank');                                                                                                                                                                                                        
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        _closetheAIPopUp: function(){                                                                                                                                                                                                                          
            this._cMenu.close();                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        _HandleQuery: function(oEvent){                                                                                                                                                                                                                        
            var oQuery = sap.ui.getCore().byId("oID_QueryInput").getValue();                                                                                                                                                                                   
            //const oQueryProcessed = new RegExp(oQuery.replace(/[\\^$.|?*+()[{]/g, '\\\\$&'));                                                                                                                                                                
            sap.ui.controller("com.qdt.zshellplugin.controller.View1").onHandleQuery(oEvent, oQuery);                                                                                                                                                          
            //this._cMenu.close();                                                                                                                                                                                                                             
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
    });                                                                                                                                                                                                                                                        
});                                                                                                                                                                                                                                                            