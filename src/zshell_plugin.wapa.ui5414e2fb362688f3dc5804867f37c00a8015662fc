sap.ui.define([                                                                                                                                                                                                                                                
    "sap/ui/core/mvc/Controller",                                                                                                                                                                                                                              
    "sap/m/MessageBox",                                                                                                                                                                                                                                        
    "sap/m/MessageToast",                                                                                                                                                                                                                                      
    "sap/ui/model/json/JSONModel"                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
], function (Controller, MessageBox, MessageToast, JSONModel) {                                                                                                                                                                                                
    "use strict";                                                                                                                                                                                                                                              
    var oUnidKey;                                                                                                                                                                                                                                              
    return Controller.extend("com.qdt.zshellplugin.controller.View1", {                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
        onInit: function () {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            this.oModel = this.getOwnerComponent().getModel();                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onAfterRendering: function () {                                                                                                                                                                                                                        
            var that = this;                                                                                                                                                                                                                                   
            setTimeout(function () {                                                                                                                                                                                                                           
                MessageToast.show("Ask ABHI is Lauched Successfully! \n \n Kindly Find the Ask ABHI Icon next to Search Menu.");                                                                                                                               
                that.onNavBack();                                                                                                                                                                                                                              
            }, 3000)                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onNavBack: function () {                                                                                                                                                                                                                               
            var oCrossAppNavigator = sap.ushell.Container.getService("CrossApplicationNavigation"); // get a handle on the global XAppNav service                                                                                                              
            var hash = (oCrossAppNavigator && oCrossAppNavigator.hrefForExternal({                                                                                                                                                                             
                target: {                                                                                                                                                                                                                                      
                    semanticObject: "shell",                                                                                                                                                                                                                   
                    action: "home"                                                                                                                                                                                                                             
                }                                                                                                                                                                                                                                              
            })); // generate the Hash to display a Supplier                                                                                                                                                                                                    
            oCrossAppNavigator.toExternal({                                                                                                                                                                                                                    
                target: {                                                                                                                                                                                                                                      
                    shellHash: hash                                                                                                                                                                                                                            
                }                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        oLoadTCodeAppsData: function (oFlexBox) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            var that = this;                                                                                                                                                                                                                                   
            var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/zz1_error_log_help_srv/");                                                                                                                                                   
            oModel.setUseBatch(false);                                                                                                                                                                                                                         
            // Show the BusyIndicator with a message                                                                                                                                                                                                           
            var oBusyDialog = new sap.m.BusyDialog({                                                                                                                                                                                                           
                text: "Processing Error Data... \n Please wait."                                                                                                                                                                                               
            });                                                                                                                                                                                                                                                
            oBusyDialog.open(); // Open the BusyIndicator                                                                                                                                                                                                      
            var oPath = "/ERROR_LOGSet(Line=1,Query='')";                                                                                                                                                                                                      
            oModel.read(oPath, {                                                                                                                                                                                                                               
                success: function (oData, oResponse) {                                                                                                                                                                                                         
                    oUnidKey = oResponse.headers.uuidc22;                                                                                                                                                                                                      
                    oBusyDialog.close();                                                                                                                                                                                                                       
                    var oDataResponse = oData;                                                                                                                                                                                                                 
                    that.oBuildFlexBoxWithResponse(oDataResponse);                                                                                                                                                                                             
                    var oFlexBox = sap.ui.getCore().byId('oID_AI_ABHI_CHAT').getItems();                                                                                                                                                                       
                    oFlexBox[oFlexBox.length-1].getItems()[0].focus();                                                                                                                                                                                         
                },                                                                                                                                                                                                                                             
                error: function (oError) {                                                                                                                                                                                                                     
                    oBusyDialog.close();                                                                                                                                                                                                                       
                    MessageBox.error("Ask ABHI, Failed to Search your Errors.");                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        oLoadInitialData: function (oFlexBox, oButton) {                                                                                                                                                                                                       
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            var that = this;                                                                                                                                                                                                                                   
            var oAppLifeCycle = sap.ushell.Container.getService("AppLifeCycle");                                                                                                                                                                               
            var oCurrentApp = oAppLifeCycle.getCurrentApplication().applicationType;                                                                                                                                                                           
            if (oCurrentApp === "UI5") {                                                                                                                                                                                                                       
                var oErrorsPicked = sap.ui.getCore().getMessageManager().getMessageModel().getData();                                                                                                                                                          
                //that.oBuildFlexBoxErrors(oErrorsPicked);                                                                                                                                                                                                     
                that.callAPI(oErrorsPicked);                                                                                                                                                                                                                   
            } else {                                                                                                                                                                                                                                           
                var oAskAbhiDialog = sap.ui.getCore().byId("oId_AskAbhiDialog");                                                                                                                                                                               
                oAskAbhiDialog.open(oButton);                                                                                                                                                                                                                  
                that.oLoadTCodeAppsData();                                                                                                                                                                                                                     
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        oBuildFlexBoxErrors: function (oErrorData) {                                                                                                                                                                                                           
            var that = this;                                                                                                                                                                                                                                   
            var oFlexBox = sap.ui.getCore().byId("oID_AI_ABHI_CHAT");                                                                                                                                                                                          
            oErrorData = oErrorData.sort((a, b) => a.type.localeCompare(b.type));                                                                                                                                                                              
            if (oErrorData.length) {                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                for (var i = 0; i < oErrorData.length; i++) {                                                                                                                                                                                                  
                    var oErrorMsg = oErrorData[i].message;                                                                                                                                                                                                     
                    if (!oErrorMsg.includes("RAISE_SHORTDUMP")) {                                                                                                                                                                                              
                        var oQueryConatiner = new sap.m.HBox();                                                                                                                                                                                                
                        var oAnswerConatiner = new sap.m.HBox();                                                                                                                                                                                               
                        var oFlexQueryBox = new sap.m.FlexBox({                                                                                                                                                                                                
                            alignItems: "End",                                                                                                                                                                                                                 
                            direction: "RowReverse"                                                                                                                                                                                                            
                        });                                                                                                                                                                                                                                    
                        var oAnswer = new sap.m.Button({                                                                                                                                                                                                       
                            text: oErrorData[i].message,                                                                                                                                                                                                       
                            type: oErrorData[i].type === 'Warning' ? 'Attention' : oErrorData[i].type === 'Error' ? 'Reject' : null,                                                                                                                           
                            width: "50rem",                                                                                                                                                                                                                    
                            height: "6rem",                                                                                                                                                                                                                    
                            textDirection: "LTR",                                                                                                                                                                                                              
                            class: "sapUiLargeMarginBegin sapUiLargeMarginEnd",                                                                                                                                                                                
                            press: function (oEvent) {                                                                                                                                                                                                         
                                that.onHandleQuery(oEvent, oEvent.getSource().getText());                                                                                                                                                                      
                            }                                                                                                                                                                                                                                  
                        });                                                                                                                                                                                                                                    
                        oAnswer.addStyleClass("myQueryButtonHeight");                                                                                                                                                                                          
                        oFlexQueryBox.addItem(oAnswer);                                                                                                                                                                                                        
                        oFlexQueryBox.addStyleClass("sapUiSmallMarginTop");                                                                                                                                                                                    
                        oQueryConatiner.addItem(oAnswer);                                                                                                                                                                                                      
                        oFlexBox.addItem(oQueryConatiner); //Global FlexBox to add as Chat.                                                                                                                                                                    
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
            this.callAPI(oErrorData);                                                                                                                                                                                                                          
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        callAPI: function(oErrorData){                                                                                                                                                                                                                         
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                             
            var that = this;                                                                                                                                                                                                                                   
            let oNavToNewTab = true;                                                                                                                                                                                                                           
            var oMessageNumber = 1;                                                                                                                                                                                                                            
            var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/zz1_error_log_help_srv/");                                                                                                                                                   
            oModel.setUseBatch(false);                                                                                                                                                                                                                         
            // Show the BusyIndicator with a message                                                                                                                                                                                                           
            var oBusyDialog = new sap.m.BusyDialog({                                                                                                                                                                                                           
                text: "Processing Error Data... \n Please wait."                                                                                                                                                                                               
            });                                                                                                                                                                                                                                                
            for(var i=0; i < oErrorData.length; i++){                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                if(oErrorData[i].type === "Error"){                                                                                                                                                                                                            
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                       
                    var oPayload = {                                                                                                                                                                                                                           
                        "Line" : oMessageNumber,                                                                                                                                                                                                               
                        "Username" : sap.ushell.Container.getService("UserInfo").getId(),                                                                                                                                                                      
                        "Msgid" : "V" + oMessageNumber,                                                                                                                                                                                                        
                        "Msgno" : "0" + oMessageNumber + "0",                                                                                                                                                                                                  
                        "Msgv1" : "",                                                                                                                                                                                                                          
                        "Msgv2" : "",                                                                                                                                                                                                                          
                        "Msgv3" : "",                                                                                                                                                                                                                          
                        "Msgv4" : "",                                                                                                                                                                                                                          
                        "Errortext" : oErrorData[i].message,                                                                                                                                                                                                   
                        "Errordate" : "",                                                                                                                                                                                                                      
                        "Errortime" : "",                                                                                                                                                                                                                      
                        "Errortype" : "FIORI",                                                                                                                                                                                                                 
                        "Query" : "",                                                                                                                                                                                                                          
                        "Response" : "",                                                                                                                                                                                                                       
                        "Semobject" : "",                                                                                                                                                                                                                      
                        "Semaction" : "",                                                                                                                                                                                                                      
                        "Table" : "",                                                                                                                                                                                                                          
                        "service" : ""                                                                                                                                                                                                                         
                    };                                                                                                                                                                                                                                         
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                       
                    oBusyDialog.open(); // Open the BusyIndicator                                                                                                                                                                                              
                    var oPath = "/ERROR_LOGSet";                                                                                                                                                                                                               
                    oModel.create(oPath, oPayload, {                                                                                                                                                                                                           
                        success: function (oData, oResponse) {                                                                                                                                                                                                 
                            oBusyDialog.close();                                                                                                                                                                                                               
                            if(oNavToNewTab){                                                                                                                                                                                                                  
                                that.onNavtoASKAbhiExternalURL();                                                                                                                                                                                              
                                oNavToNewTab = false;                                                                                                                                                                                                          
                            }                                                                                                                                                                                                                                  
                        },                                                                                                                                                                                                                                     
                        error: function (oError) {                                                                                                                                                                                                             
                            oBusyDialog.close();                                                                                                                                                                                                               
                            MessageBox.error("Ask ABHI, Failed to Post your Errors.");                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                    oMessageNumber++;                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                               
                                                                                                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                             
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onNavtoASKAbhiExternalURL: function(){                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            var sUserID = sap.ushell.Container.getService("UserInfo").getId();                                                                                                                                                                                 
            var sURL = "https://www.ask-abhi.34.160.35.150.nip.io/" + sUserID + "/";                                                                                                                                                                           
            MessageBox.confirm("ASK Abhi will be Launching in new Tab. \n \n Do you want to proceed?", {                                                                                                                                                       
                title: "Confirmation.",                                                                                                                                                                                                                        
                actions: [MessageBox.Action.OK, MessageBox.Action.CANCEL],                                                                                                                                                                                     
                emphasizedAction: MessageBox.Action.YES,                                                                                                                                                                                                       
                onClose: function (oAction) {                                                                                                                                                                                                                  
                    if (oAction === MessageBox.Action.OK) {                                                                                                                                                                                                    
                       sap.m.URLHelper.redirect(sURL, true);                                                                                                                                                                                                   
                       sap.ui.getCore().byId("oId_AskAbhiDialog").close();                                                                                                                                                                                     
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        oBuildFlexBoxWithResponse: function (oData) {                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
            var that = this;                                                                                                                                                                                                                                   
            var oFlexBox = sap.ui.getCore().byId("oID_AI_ABHI_CHAT");                                                                                                                                                                                          
            var oQueryConatiner = new sap.m.HBox();                                                                                                                                                                                                            
            var oAnswerConatiner = new sap.m.HBox();                                                                                                                                                                                                           
            if (oData.Query) {                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                var oFlexQueryBox = new sap.m.FlexBox({                                                                                                                                                                                                        
                    alignItems: "End",                                                                                                                                                                                                                         
                    direction: "RowReverse"                                                                                                                                                                                                                    
                });                                                                                                                                                                                                                                            
                var oAnswer = new sap.m.TextArea({                                                                                                                                                                                                             
                    value: oData.Query,                                                                                                                                                                                                                        
                    growing: true,                                                                                                                                                                                                                             
                    rows: 3,                                                                                                                                                                                                                                   
                    growingMaxLines: 10,                                                                                                                                                                                                                       
                    showExceededText: true,                                                                                                                                                                                                                    
                    width: "100%",                                                                                                                                                                                                                             
                    editable: false,                                                                                                                                                                                                                           
                    wrapping: "Hard",                                                                                                                                                                                                                          
                    class: "sapUiLargeMarginBegin"                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                oAnswer.addStyleClass("myJouleFont");                                                                                                                                                                                                          
                oAnswer.addStyleClass("myTextAreaColor");                                                                                                                                                                                                      
                oFlexQueryBox.addItem(oAnswer);                                                                                                                                                                                                                
                oFlexQueryBox.addStyleClass("sapUiSmallMarginTop");                                                                                                                                                                                            
                oQueryConatiner.addItem(oAnswer);                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
            oFlexBox.addItem(oQueryConatiner); //Global FlexBox to add as Chat.                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            if (oData.Response) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var oFlexAnswerBox = new sap.m.FlexBox({                                                                                                                                                                                                       
                    alignItems: "Start",                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                var oAnswer = new sap.m.TextArea({                                                                                                                                                                                                             
                    value: oData.Response,                                                                                                                                                                                                                     
                    growing: true,                                                                                                                                                                                                                             
                    rows: 25,                                                                                                                                                                                                                                  
                    growingMaxLines: 10,                                                                                                                                                                                                                       
                    width: "100%",                                                                                                                                                                                                                             
                    showExceededText: true,                                                                                                                                                                                                                    
                    editable: false,                                                                                                                                                                                                                           
                    wrapping: "Hard",                                                                                                                                                                                                                          
                    class: "sapUiLargeMarginEnd"                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                oAnswer.addStyleClass("myJouleFont");                                                                                                                                                                                                          
                oAnswer.addStyleClass("myTextAreaColor");                                                                                                                                                                                                      
                oFlexAnswerBox.addItem(oAnswer);                                                                                                                                                                                                               
                oFlexAnswerBox.addStyleClass("sapUiSmallMarginTop");                                                                                                                                                                                           
                oAnswerConatiner.addItem(oAnswer);                                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            oFlexBox.addItem(oAnswerConatiner); //Global FlexBox to add as Chat.                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onHandleQuery: function (oEvent, oQuery) {                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            var that = this;                                                                                                                                                                                                                                   
            var oModel = new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/zz1_error_log_help_srv/");                                                                                                                                                   
            oModel.setUseBatch(false);                                                                                                                                                                                                                         
            var oQueryContextType = sap.ui.getCore().byId('oID_QueryContextType').getSelected();                                                                                                                                                               
            if(!oQueryContextType){                                                                                                                                                                                                                            
                oUnidKey = "";                                                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
            // Show the BusyIndicator with a message                                                                                                                                                                                                           
            var oBusyDialog = new sap.m.BusyDialog({                                                                                                                                                                                                           
                text: "Processing Your Query... \n Please wait."                                                                                                                                                                                               
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            var escaped = oQuery.replace(/'/g, "''");                                                                                                                                                                                                          
            // URL encode the result for query string use                                                                                                                                                                                                      
            oQuery = encodeURIComponent(escaped);                                                                                                                                                                                                              
            oBusyDialog.open(); // Open the BusyIndicator                                                                                                                                                                                                      
            var oPath = "/ERROR_LOGSet(Line=2,Query='" + oQuery + "')";                                                                                                                                                                                        
            oModel.read(oPath, {                                                                                                                                                                                                                               
                headers: {                                                                                                                                                                                                                                     
                    "uuidc22": oUnidKey || ""                                                                                                                                                                                                                  
                },                                                                                                                                                                                                                                             
                success: function (oData, oResponse) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oUnidKey = oResponse.headers.uuidc22;                                                                                                                                                                                                      
                    oBusyDialog.close();                                                                                                                                                                                                                       
                    var oDataResponse = oData;                                                                                                                                                                                                                 
                    that.oBuildFlexBoxWithResponse(oDataResponse);                                                                                                                                                                                             
                    sap.ui.getCore().byId('oID_QueryInput').setValue('');                                                                                                                                                                                      
                    var oFlexBox = sap.ui.getCore().byId('oID_AI_ABHI_CHAT').getItems();                                                                                                                                                                       
                    oFlexBox[oFlexBox.length-1].getItems()[0].focus();                                                                                                                                                                                         
                },                                                                                                                                                                                                                                             
                error: function (oError) {                                                                                                                                                                                                                     
                    oBusyDialog.close();                                                                                                                                                                                                                       
                    MessageBox.error("Ask ABHI, Failed to Search your Errors.");                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
    });                                                                                                                                                                                                                                                        
});                                                                                                                                                                                                                                                            